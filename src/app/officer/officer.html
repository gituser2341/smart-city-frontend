<div class="dashboard">

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="role-icon">ğŸ‘®</div>
      <div>
        <h1 class="header-title">Officer Dashboard</h1>
        <p class="header-sub">Welcome, {{ officerName }}</p>
      </div>
    </div>
    <div class="header-right">
      <button class="btn-notif" routerLink="/notifications">ğŸ”” Notifications</button>
      <button class="btn-logout" (click)="logout()">â‹ Logout</button>
    </div>
  </header>

  <!-- Stats -->
  <section class="stats-grid">
    <div class="stat-card stat-total">
      <div class="stat-icon">ğŸ“‹</div>
      <div class="stat-number">{{ total }}</div>
      <div class="stat-label">Assigned</div>
    </div>
    <div class="stat-card stat-progress">
      <div class="stat-icon">âš™ï¸</div>
      <div class="stat-number">{{ inProgress }}</div>
      <div class="stat-label">In Progress</div>
    </div>
    <div class="stat-card stat-resolved">
      <div class="stat-icon">âœ…</div>
      <div class="stat-number">{{ resolved }}</div>
      <div class="stat-label">Resolved</div>
    </div>
  </section>

  <!-- Complaints -->
  <section class="complaints-section">
    <h2 class="section-title">Assigned Complaints</h2>

    <!-- Loading -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Loading complaints...</p>
    </div>

    <div class="complaints-list" *ngIf="!isLoading">

      <!-- Empty -->
      <div class="empty-state" *ngIf="complaints.length === 0">
        <div class="empty-icon">ğŸ“­</div>
        <p>No complaints assigned yet</p>
        <span>You'll see complaints here once admin assigns them to you</span>
      </div>

      <div *ngFor="let c of complaints" class="complaint-card"
        [ngClass]="{'card-emergency': c.priority === 'EMERGENCY'}">

        <div class="complaint-header">
          <h3 class="complaint-title">{{ c.title }}</h3>
          <div class="badges">
            <span class="status-badge"
              [ngClass]="{
                'status-open':     c.status === 'OPEN',
                'status-progress': c.status === 'IN_PROGRESS',
                'status-resolved': c.status === 'RESOLVED'
              }">
              {{ c.status }}
            </span>
            <span class="priority-badge"
              [ngClass]="{
                'p-low':       c.priority === 'LOW',
                'p-medium':    c.priority === 'MEDIUM',
                'p-high':      c.priority === 'HIGH',
                'p-emergency': c.priority === 'EMERGENCY'
              }">
              {{ c.priority }}
            </span>
          </div>
        </div>

        <p class="complaint-desc">{{ c.description }}</p>

        <div class="complaint-meta">
          <span class="meta-item">ğŸ¢ {{ c.department }}</span>
          <span class="meta-item">ğŸ• {{ c.createdAt | date: 'dd MMM yyyy, h:mm a' }}</span>
          <span class="meta-item">ğŸ“ {{ c.latitude }}, {{ c.longitude }}</span>
          <span class="meta-item" *ngIf="c.user">ğŸ‘¤ {{ c.user?.name }}</span>
        </div>

        <!-- Image -->
        <div class="complaint-image" *ngIf="c.imageUrl">
          <img [src]="'http://localhost:8080/' + c.imageUrl" alt="Complaint Photo" />
        </div>

        <!-- âœ… Map Preview -->
        <div class="map-section" *ngIf="c.latitude && c.longitude">
          <p class="map-label">ğŸ“ Complaint Location</p>
          <div class="map-frame">
            <iframe
              [src]="getSafeMapUrl(c.latitude, c.longitude)"
              class="map-iframe"
              frameborder="0"
              loading="lazy">
            </iframe>
          </div>
        </div>

        <!-- Status Update -->
        <div class="status-update" *ngIf="c.status !== 'RESOLVED'">
          <span class="update-label">Update Status:</span>
          <div class="status-buttons">
            <button
              class="btn-status btn-progress"
              [ngClass]="{'btn-active': c.status === 'IN_PROGRESS'}"
              (click)="updateStatus(c.id, 'IN_PROGRESS')">
              âš™ï¸ In Progress
            </button>
            <button
              class="btn-status btn-resolve"
              (click)="updateStatus(c.id, 'RESOLVED')">
              âœ… Mark Resolved
            </button>
          </div>
        </div>

        <div class="resolved-badge" *ngIf="c.status === 'RESOLVED'">
          âœ… This complaint has been resolved
        </div>

      </div>
    </div>
  </section>
</div>